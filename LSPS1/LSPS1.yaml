openapi: 3.0.3
info:
  description: |
    API documentation for channel opening request from a Lightning Network Service Provider (LSP).
    

    ### Features
    The api is split up in to the base api and additional features.
    All supported additional features are listed in the general API info endpoint.
    Features can add additional endpoints or fields.

    ### Onchain payments
    Any on chain addresses can be omitted if the LSP doesnt want to support onchain payments. 
    This can also be the case selective. For example, when the payment is too small.
    
  version: "0.0.2"
  title: "LSP Spec 1"
tags:
- name: "API Info"
- name: "Channel Request"
- name: "LNURL"
  description: "Feature: `lnurl_lud2`."
- name: "JIT"
  description: "Feature: `jit_channels`."
- name: "Refund"
  description: "Feature: `refunds`."


paths:
  /lsp/channels:
    get:
      tags:
      - "API Info"
      summary: "Get general API information."
      description: |
        Get general information about this API and supported features.
        
      operationId: "channel-order-info"
      responses:
        "200":
          description: |
            ## Supported features
            
            ### lnurl_lud2
            Indicates if [LNURL LUD2 channel request](https://github.com/lnurl/luds/blob/luds/02.md) is supported.
            
            ### local_balance
            Indicates if the LSP is willing to push satoshi to the receiver side.
            
            ### refunds
            Indicates if the LSP supports automatic refunds.
            
            ### jit_channels
            Indicates if the LSP supports Just-In-Time channels.
            
          content:
              application/json:
                schema:
                    $ref: "#/components/schemas/ChannelApiInfo"
                example:
                - lnurl_lud2 # LNURL channel request
                - jit_channels # Just-In-Time Channels
                - name: local_balance # Push balance to user
                - name: onchain_payments
                  min_satoshi: 50000
                - refunds # Refunds via api
  
    post:
      tags:
      - "Channel Request"
      summary: "Requests a new channel order from the LSP."
      description: |
        This endpoint accepts arguments for a channel with a specific size and duration and returns the order information.
        
      operationId: "new-channel-request"
      requestBody:
          description: "Information needed to create your new deposit invoice."
          required: true
          content:
              application/json:
                  schema:
                      $ref: '#/components/schemas/ChannelOrderRequest'
      responses:
        "201":
          description: "Created"
          content:
              application/json:
                schema:
                  $ref: "#/components/schemas/ChannelOrderResponse"
        "400":
          description: "Validation error."
            

              
  /lsp/channels/{id}:
    get:
      tags:
      - Channel Request
      summary: "Get information about a channel order."
      description: "Get information about a channel order"
      operationId: "get-channel-order"

      parameters:
        - in: path
          name: id
          description: "Order id"
          required: true
          schema:
              type: string
      responses:
        "200":
          description: "Channel information"
          content:
              application/json:
                schema:
                  $ref: "#/components/schemas/Order"
        "404":
          description: "Not found"
          
  /lsp/channels/{id}/open:
    post:
      tags:
      - "Channel Request"
      summary: "Opens a previously paid channel."
      description: |
        This endpoint accepts arguments to open a channel to a specific node. It performs an actual channel open and returns success/error.
      operationId: "open-channel-request"
      parameters:
        - in: path
          name: id
          description: "Order id."
          required: true
          schema:
              type: string
      requestBody:
          description: "Information needed to open the channel."
          required: true
          content:
              application/json:
                  schema:
                      $ref: '#/components/schemas/ChannelOpenRequest'
      responses:
        "201":
          description: "Success"
          content:
              application/json:
                schema:
                  $ref: "#/components/schemas/ChannelOpenResponse"
        "400":
          description: "Validation error"
        "404":
          description: "Not found"
        "412":
          description: "Channel open failed"
          content:
              application/json:
                schema:
                  $ref: "#/components/schemas/ChannelOpenResponse"

  /lsp/channels/{id}/jit:
    get:
      tags:
      - JIT
      summary: "Get information about registered JIT node."
      description: |
        Get information about registered JIT node. Feature: `jit_channels`.
      operationId: "get-channel-jit"

      parameters:
        - in: path
          name: id
          description: "Order id"
          required: true
          schema:
              type: string
      responses:
        "200":
          description: "Channel information"
          content:
              application/json:
                schema:
                  $ref: "#/components/schemas/ChannelJITResponse"
        "404":
          description: "Not found"
    post:
      tags:
      - JIT
      summary: "Register the JIT node."
      description: |
        Register JIT node. Feature: `jit_channels`.
      operationId: "post-channel-jit"

      parameters:
        - in: path
          name: id
          description: "Order id"
          required: true
          schema:
              type: string
      requestBody:
          description: "Information needed to connect to the node."
          required: true
          content:
              application/json:
                  schema:
                      $ref: '#/components/schemas/ChannelJITRequest'
      responses:
        "200":
          description: "Channel information"
          content:
              application/json:
                schema:
                  $ref: "#/components/schemas/ChannelJITResponse"
        "404":
          description: "Not found"
                  
  /lsp/channels/{id}/lnurl:
    get:
      tags:
      - LNURL
      summary: "Get LNURL LUD2."
      description: |
        Get the LNURL LUD2 string. Feature: `lnurl_lud2`.
      operationId: "get-channel-lnurl-lud2"

      parameters:
        - in: path
          name: id
          description: "Order id"
          required: true
          schema:
              type: string
      responses:
        "200":
          description: "Channel information"
          content:
              application/json:
                schema:
                  $ref: "#/components/schemas/ChannelOpenLnurlResponse"
        "404":
          description: "Not found"
                  
                  
  /lsp/channels/{id}/refund:
    get:
      tags:
      - Refund
      summary: "Get information about refunds."
      description: "Get information about refunds."
      operationId: "get-channel-refund"

      parameters:
        - in: path
          name: id
          description: "Order id"
          required: true
          schema:
              type: string
      responses:
        "200":
          description: "Refund information"
          content:
              application/json:
                schema:
                  $ref: "#/components/schemas/ChannelRefundGetResponse"
        "404":
          description: "Not found"
          
    post:
      tags:
      - Refund
      summary: "Refunds a paid offer."
      description: "Refunds a paid offer. Can be before the channel has been opened or due to an issue."
      operationId: "post-channel-refund"
      parameters:
        - in: path
          name: id
          description: "Order id."
          required: true
          schema:
              type: string
      requestBody:
          description: "Information needed to refund the payment."
          required: true
          content:
              application/json:
                  schema:
                      $ref: '#/components/schemas/ChannelRefundPostRequest'
      responses:
        "200":
          description: "Success"
          content:
              application/json:
                schema:
                  $ref: "#/components/schemas/ChannelRefundPostResponse"
        "400":
          description: "Validation error"
        "404":
          description: "Not found"
        "412":
          description: "Channel refund failed"
          content:
              application/json:
                schema:
                  $ref: "#/components/schemas/ChannelRefundPostResponse"
    
components:
    schemas:
      ChannelApiInfo:
        type: "object"
        properties:
          version:
            type: string
            description: "Version of this api. See https://github.com/BitcoinAndLightningLayerSpecs/lsp"
            example: '0.0.2'
          features:
            type: array
            items:
              $ref: "#/components/schemas/ApiFeature"
          website:
            type: string
            description: "Website that provides devs a way to get in contact and/or TOS."
            example: "https://blocktank.to/contact"
    
      ChannelOrderRequest:
        type: "object"
        required:
          - remote_balance
        properties:
          remote_balance:
            type: integer
            description: "Inbound liquidity amount in satoshis. Funds are at the LSP side."
            example: 5000000
            minimum: 0
          local_balance:
            type: integer
            description: "Outbound liquidity amount in satoshis. Funds are at the user side."
            default: 0
            example: 2000000
            minimum: 0
          onchain_fee_rate:
            type: number
            description: "On-chain fee rate of the channel opening transaction in satoshis per vbyte."
            minimum: 1
          channel_expiry:
            type: integer
            description: "Channel expiration in weeks."
            minimum: 1
            example: 12
          coupon_code:
            type: string
            description: "Coupon code to get a discount on the purchase."
            default: ''
            
      ChannelOrderResponse:
        type: "object"
        properties:
          id:
            type: string
            description: "An lsp generated order id used to look-up the status of this request."
            example: bb4b5d0a-8334-49d8-9463-90a6d413af7c
          fee_total:
            type: integer
            description: "The total fee in satoshi the LSP will charge to open this channel."
            example: 8888
            minimum: 0
          order_total:
            type: integer
            description: "fee_total plus the local_balance requested in satoshi."
            example: 2008888
            minimum: 0
          order_expiry_ts:
            description: "Number of seconds since epoch when this order can still be paid."
            type: integer
            example: 1672661897
          ln_invoice:
            type: string
            description: "A lightning bolt11 invoice to pay the fee for this channel open."
            example: "lnbc252u1p3aht9ysp580g4633gd2x9lc5al0wd8wx0mpn9748jeyz46kqjrpxn52uhfpjqpp5qgf67tcqmuqehzgjm8mzya90h73deafvr4m5705l5u5l4r05l8cqdpud3h8ymm4w3jhytnpwpczqmt0de6xsmre2pkxzm3qydmkzdjrdev9s7zhgfaqxqyjw5qcqpjrzjqt6xptnd85lpqnu2lefq4cx070v5cdwzh2xlvmdgnu7gqp4zvkus5zapryqqx9qqqyqqqqqqqqqqqcsq9q9qyysgqen77vu8xqjelum24hgjpgfdgfgx4q0nehhalcmuggt32japhjuksq9jv6eksjfnppm4hrzsgyxt8y8xacxut9qv3fpyetz8t7tsymygq8yzn05"
          btc_address:
            type: string
            nullable: true
            description: "An on-chain bitcoin address to pay the fee for this channel open."
            example: "bc1p5uvtaxzkjwvey2tfy49k5vtqfpjmrgm09cvs88ezyy8h2zv7jhas9tu4yr"
          request:
            $ref: "#/components/schemas/ChannelOrderRequest"
            
      Order:
        type: "object"
        properties:
          id:
            type: string
            description: "An lsp generated order id used to look-up the status of this request"
            example: bb4b5d0a-8334-49d8-9463-90a6d413af7c
          created_at:
            description: "Number of seconds since epoch when this order was created."
            type: "number"
            example: 1675340297
          state:
            description: "The state of the order."
            type: "string"
            enum:
              - AWAITING_PAYMENT
              - OFFER_EXPIRED
              - PENDING_CHANNEL_OPEN
              - COMPLETED
            example: COMPLETED
          request:
            $ref: "#/components/schemas/ChannelOrderRequest"
          payment:
            type: object
            properties:
              state:
                description: "The state of the payment."
                type: "string"
                enum:
                  - CREATED
                  - UNDER_FUNDED
                  - PAID
                  - REFUNDED
                example: PAID
              order_expiry_ts:
                description: "Number of seconds since epoch when this order can still be paid."
                type: integer
                example: 1672661897
              fee_total:
                description: "The total fee the lsp will charge to open this channel in satoshi."
                type: integer
                example: 8888
              order_total:
                description: "fee_total plus the local_balance requested in satoshi."
                type: integer
                example: 2008888
              amount_paid:
                description: "Amount paid by client so far in satoshi."
                type: number
                example: 1200
              ln_invoice:
                description: "A lightning bolt11 invoice to pay the fee for this channel open."
                type: "string"
                example: "lnbc252u1p3aht9ysp580g4633gd2x9lc5al0wd8wx0mpn9748jeyz46kqjrpxn52uhfpjqpp5qgf67tcqmuqehzgjm8mzya90h73deafvr4m5705l5u5l4r05l8cqdpud3h8ymm4w3jhytnpwpczqmt0de6xsmre2pkxzm3qydmkzdjrdev9s7zhgfaqxqyjw5qcqpjrzjqt6xptnd85lpqnu2lefq4cx070v5cdwzh2xlvmdgnu7gqp4zvkus5zapryqqx9qqqyqqqqqqqqqqqcsq9q9qyysgqen77vu8xqjelum24hgjpgfdgfgx4q0nehhalcmuggt32japhjuksq9jv6eksjfnppm4hrzsgyxt8y8xacxut9qv3fpyetz8t7tsymygq8yzn05"
              btc_address:
                description: "An on-chain bitcoin address to pay the fee for this channel open."
                type: "string"
                nullable: true
                example: 'bc1p5uvtaxzkjwvey2tfy49k5vtqfpjmrgm09cvs88ezyy8h2zv7jhas9tu4yr'
              onchain_payments:
                description: "A list of payments received to btc_address onchain."
                nullable: true
                type: "array"
                items:
                  type: object
                  properties:
                    transaction_id:
                      type: string
                      description: "Transaction id"
                      example: '0301e0480b374b32851a9462db29dc19fe830a7f7d7a88b81612b9d42099c0ae'
                    out_point:
                      type: integer
                      example: 0
                    amount:
                      type: integer
                      description: "Transaction amount in satoshi"
                      example: 1200
                    zero_conf:
                      type: boolean
                      description: "If payment was accepted as zero confirmation"
                      example: false
          channel:
            type: object
            nullable: true
            properties:
              state:
                type: string
                enum:
                  - OPENING
                  - OPENED
                  - CLOSING
                  - CLOSED
              opened_ts:
                description: "Number of seconds since epoch when the channel has been opened."
                type: integer
                example: 1672661897
              open_transaction:
                description: "The txid of the channel funding tx once it is broadcast."
                type: "string"
                example: '0301e0480b374b32851a9462db29dc19fe830a7f7d7a88b81612b9d42099c0ae:1'
              scid:
                type: string
                description: "Short channel id of the channel. Only available after channel confirmed."
                example: '643904x1419x1'
                nullable: true
              expiry_ts:
                description: "Number of seconds since epoch when the channel can be closed. Only available after channel is opened."
                type: integer
                example: 1672661899
                nullable: true
              closing_transaction:
                description: "The txid of the channel closing tx once it is broadcast."
                type: "string"
                nullable: true
                example: '0301e0480b374b32851a9462db29dc19fe830a7f7d7a88b81612b9d42099c0ae:1'
              closed_ts:
                description: "Number of seconds since epoch when the channel has been closed."
                type: integer
                example: 1672661898
                nullable: true
              node_id:
                description: "The node id of the customer node."
                type: "string"
                example: "03d4e028a0d4a90868ec202ab684fb0085779defea9ca7553e06146557631eec20@xahwmijytzsgjeo5z2spaj2kcmbawdw2bn7kejtbftvazhhvcn5wloqd.onion:9735"
              lsp_node_id:
                description: "The node id of the lsp node."
                type: "string"
                example: "0296b2db342fcf87ea94d981757fdf4d3e545bd5cef4919f58b5d38dfdd73bf5c9@34.79.58.84:9735"
          

      ChannelOpenRequest:
        type: "object"
        required:
          - announce_channel
          - node_connection_string
        properties:
          announce_channel:
            type: boolean
            description: "If the channel should be announced to the network. Also known as private/public channels."
            example: true
          node_connection_string:
            type: string
            description: "Node connection string to open the channel to."
            example: "03864ef025fde8fb587d989186ce6a4a186895ee44a926bfc370e2c366597a3f8f@3.33.236.230:9735"
            
      ChannelOpenResponse:
        type: "object"
        properties:
          success:
            type: boolean
            description: "Indicates if the channel has been opened."
            example: true
          message:
            type: string
            description: "Human readable message."
            example: "ok"
          fail_reason:
            type: string
            nullable: true
            description: "Reason the channel couldn't be opened."
            enum:
              - CHANNEL_REJECTED_BY_DESTINATION # For example wumbo not enabled.
              - PEERING_FAILED # Couldn't establish a peer connection
              - REJECTED_BY_LSP # LSP rejected node.
              - PAYMENT_REQUIRED
              - ALREADY_OPEN
            example: null
          lsp_node_connection_string:
            type: string
            nullable: true
            description: "Node connection string that tried to connect."
            
      ChannelOpenLnurlResponse:
        type: "object"
        properties:
          lnurl_channel:
            type: string
            description: "Encoded LNURL LUD2 string."
            example: "lnurl1dp68gurn8ghj7mrww4exctt5dahkccn00qhxget8wfjk2um0veax2un09e3k7mf0w5lhz0fevvunqcnzxuckxd3n8ymn2ef5ve3kyvrx8qmngc33vymkzvenvesnscm9xuunjwrzxgcxxvrrvcmxgvtyvvmkyc33vsmnjd3svgckzcrx382"

      ChannelRefundGetResponse:
        type: "object"
        properties:
          refund_state:
            type: string
            enum:
              - AVAILABLE
              - PAID_OUT
              - IN_FLIGHT # Stuck payment. Resolves later.
              - UNAVAILABLE
            description: "Is a refund possible?"
            example: AVAILABLE
          amounts:
            type: object
            nullable: true
            properties:
              lightning:
                type: integer
                description: "Satoshi available for refunds on lightning."
                example: 2008888
              onchain:
                type: integer
                description: "Satoshi available for refunds onchain."
                example: 2005000
          paid_to:
           type: string
           description: "Either Lightning invoice or onchain address where the refund has been paid to."
           nullable: true
           example: null
          paid_ts:
            type: integer
            description: "Number of seconds since epoch when this refund was given."
            example: null
            nullable: true
                
      ChannelRefundPostRequest:
        type: "object"
        properties:
          lightning_invoice: # Either or onchain_address
            type: string
            nullable: true
            description: "Lightning invoice where the refund should be paid to. Invoice should have the same amount as the offered refund."
            example: "lnbc252u1p3aht9ysp580g4633gd2x9lc5al0wd8wx0mpn9748jeyz46kqjrpxn52uhfpjqpp5qgf67tcqmuqehzgjm8mzya90h73deafvr4m5705l5u5l4r05l8cqdpud3h8ymm4w3jhytnpwpczqmt0de6xsmre2pkxzm3qydmkzdjrdev9s7zhgfaqxqyjw5qcqpjrzjqt6xptnd85lpqnu2lefq4cx070v5cdwzh2xlvmdgnu7gqp4zvkus5zapryqqx9qqqyqqqqqqqqqqqcsq9q9qyysgqen77vu8xqjelum24hgjpgfdgfgx4q0nehhalcmuggt32japhjuksq9jv6eksjfnppm4hrzsgyxt8y8xacxut9qv3fpyetz8t7tsymygq8yzn05"
          onchain_address: # Either or lightning_invoice
            type: string
            nullable: true
            description: "Onchain address where the refund should be paid to."
            example: "bc1p5uvtaxzkjwvey2tfy49k5vtqfpjmrgm09cvs88ezyy8h2zv7jhas9tu4yr"
          
          
      ChannelRefundPostResponse:
        type: "object"
        properties:
          success:
            type: boolean
            description: "Indicates if the channel has been opened."
            example: true
          message:
            type: string
            description: "Human readable message."
            example: "ok"
          fail_reason:
            type: string
            nullable: true
            description: "Reason the refund failed."
            enum:
              - PAYMENT_FAILED # For example, path not found
              - REJECTED_BY_LSP # LSP rejected node.
              - UNSUPPORTED
            example: null

      ChannelJITRequest:
        type: "object"
        required:
          - node_connection_string
        properties:
          node_connection_string:
            description: "The node connection string that the channel will be opened to in case of an incoming payment."
            example: "03864ef025fde8fb587d989186ce6a4a186895ee44a926bfc370e2c366597a3f8f@3.33.236.230:9735"
            type: "string"

      ChannelJITResponse:
        type: "object"
        properties:
          fee_per_payment:
            description: "For intercepted payment of fee, fee in satoshi taken from each payment until fee is paid."
            type: integer
            example: 50
          route_hint:
            type: object
            nullable: true
            properties:
              scid:
                description: "The short_channel_id the user puts in the route hint of the invoice. See BOLT#7 for scid definition."
                example: "733904x1451x0"
                type: "string"
              node_id:
                description: "The node_id the user puts in the route hint of the invoice."
                example: "031015a7839468a3c266d662d5bb21ea4cea24226936e2864a7ca4f2c3939836e0"
                type: "string"
          registerd_node_connection_string:
            description: "The registerd node id that the channel will be opened to in case of an incoming payment."
            example: "03864ef025fde8fb587d989186ce6a4a186895ee44a926bfc370e2c366597a3f8f@3.33.236.230:9735"
            type: "string"
            nullable: true
      
      BaseApiFeature:
        type: object
        properties:
          name:
            type: string
            example: 'local_balance'
            description: Feature name.
        
      OnchainPaymentApiFeature:
        # Extends BaseApiFeature
        allOf:
          - $ref: "#/components/schemas/BaseApiFeature"
          - type: object
            properties:
              min_satoshi:
                type: string
                description: "Minimal number of satoshi required to be eligable for an onchain payment."
                example: 50000

      ApiFeature:
      # One of these types need to match
        oneOf:
          - type: string
          - $ref: "#/components/schemas/BaseApiFeature"
          - $ref: "#/components/schemas/OnchainPaymentApiFeature"

          
          
          
          
          
            